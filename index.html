
Dan <danieldgschofield@gmail.com>
10:28 AM (0 minutes ago)
to me

function runSimulation() {
    let startPrice = parseFloat(document.getElementById("mcStartPrice").value);
    let days = parseInt(document.getElementById("mcDays").value);
    let simulations = parseInt(document.getElementById("mcSimulations").value);

    let results = [];

    for (let i = 0; i < simulations; i++) {
        let price = startPrice;
        for (let day = 0; day < days; day++) {
            let randomShock = (Math.random() - 0.5) * 0.02; // daily ±1%
            price *= (1 + randomShock);
        }
        results.push(price);
    }

    let avg = results.reduce((a,b)=>a+b)/simulations;
    let changePercent = ((avg - startPrice)/startPrice*100).toFixed(2);
    document.getElementById("result").innerText = 
        `Starting £${startPrice.toFixed(2)}, average after ${days} days: £${avg.toFixed(2)} (${changePercent}%)`;

    // Line chart (first simulation)
    let ctx = document.getElementById('mcChart').getContext('2d');
    let sample = [startPrice];
    let price = startPrice;
    for (let day = 0; day < days; day++) {
        let randomShock = (Math.random() - 0.5) * 0.02;
        price *= (1 + randomShock);
        sample.push(price);
    }
    if(window.mcLineChart) window.mcLineChart.destroy();
    window.mcLineChart = new Chart(ctx, {
      type:'line',
      data: { labels: sample.map((_,i)=>i+1), datasets:[{label:'Sample Simulation (£)', data:sample, borderColor:'#38bdf8', borderWidth:2}] },
      options:{responsive:true, plugins:{legend:{labels:{color:'#e2e8f0'}}}}
    });

    // Histogram
    let bins = new Array(20).fill(0);
    let min = Math.min(...results);
    let max = Math.max(...results);
    let binWidth = (max - min)/bins.length;
    results.forEach(val=>{
        let idx = Math.floor((val-min)/binWidth);
        if(idx>=bins.length) idx=bins.length-1;
        bins[idx]++;
    });
    let labels = bins.map((_,i)=>(min + i*binWidth).toFixed(2));
    let ctxHist = document.getElementById('mcHistogram').getContext('2d');
    if(window.mcHistChart) window.mcHistChart.destroy();
    window.mcHistChart = new Chart(ctxHist,{
      type:'bar',
      data:{labels:labels,datasets:[{label:'Simulation Outcome Distribution (£)',data:bins,backgroundColor:'#38bdf8'}]},
      options:{responsive:true, plugins:{legend:{labels:{color:'#e2e8f0'}}}}
    });
}

// Compound Interest
function runCompound() {
    let principal = parseFloat(document.getElementById("ciPrincipal").value);
    let rate = parseFloat(document.getElementById("ciRate").value)/100;
    let years = parseInt(document.getElementById("ciYears").value);

    let amount = principal * Math.pow((1+rate), years);
    document.getElementById("compoundResult").innerText =
      `£${principal.toFixed(2)} invested at ${(rate*100).toFixed(2)}% for ${years} years grows to: £${amount.toFixed(2)}`;
}
